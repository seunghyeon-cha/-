(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5574],{4115:function(e,t,r){Promise.resolve().then(r.bind(r,6181))},9376:function(e,t,r){"use strict";var a=r(5475);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"usePathname")&&r.d(t,{usePathname:function(){return a.usePathname}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}}),r.o(a,"useSearchParams")&&r.d(t,{useSearchParams:function(){return a.useSearchParams}})},5523:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RouterContext",{enumerable:!0,get:function(){return a}});let a=r(7043)._(r(2265)).default.createContext(null)},6181:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var a=r(7437),s=r(2265),n=r(9376),i=r(9032),o=r(3145),l=r(426),c=r(7802);function u(e){let{currentImage:t,userName:r,onImageChange:n}=e,[i,u]=(0,s.useState)(t),[d,m]=(0,s.useState)(!1),p=(0,s.useRef)(null),x=async e=>{var r;let a=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!a)return;if(!a.type.startsWith("image/")){c.A.warning("이미지 파일만 업로드 가능합니다");return}if(a.size>5242880){c.A.warning("파일 크기는 5MB 이하여야 합니다");return}let s=new FileReader;s.onloadend=()=>{u(s.result)},s.readAsDataURL(a);try{m(!0);let e=await (0,l.e)([a]);e.urls&&e.urls.length>0&&(n(e.urls[0]),c.A.success("이미지가 업로드되었습니다"))}catch(e){console.error("Image upload failed:",e),c.A.error("이미지 업로드에 실패했습니다"),u(t)}finally{m(!1)}};return(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsxs)("div",{onClick:()=>{var e;null===(e=p.current)||void 0===e||e.click()},className:"relative w-32 h-32 rounded-full overflow-hidden cursor-pointer group border-4 border-white shadow-lg",children:[i?(0,a.jsx)(o.default,{src:i,alt:r,fill:!0,className:"object-cover",unoptimized:!0}):(0,a.jsx)("div",{className:"w-full h-full bg-primary-500 flex items-center justify-center text-white text-5xl font-bold",children:r.charAt(0).toUpperCase()}),(0,a.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 flex items-center justify-center",children:(0,a.jsx)("div",{className:"text-white text-sm font-medium opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:d?(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white mb-2"}),(0,a.jsx)("span",{children:"업로드 중..."})]}):(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("span",{className:"text-3xl mb-1",children:"\uD83D\uDCF7"}),(0,a.jsx)("span",{children:"변경"})]})})})]}),(0,a.jsx)("input",{ref:p,type:"file",accept:"image/*",onChange:x,className:"hidden",disabled:d}),(0,a.jsxs)("p",{className:"mt-4 text-sm text-gray-600 text-center",children:["클릭하여 프로필 사진 변경",(0,a.jsx)("br",{}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"(JPG, PNG, GIF / 최대 5MB)"})]})]})}var d=r(9375);function m(){let e=(0,n.useRouter)(),{isAuthenticated:t}=(0,d.t)(),[r,o]=(0,s.useState)(!0),[l,m]=(0,s.useState)(!1),[p,x]=(0,s.useState)(null),[f,h]=(0,s.useState)({name:"",bio:"",profileImage:""}),[g,b]=(0,s.useState)({});(0,s.useEffect)(()=>{if(!t){e.push("/login");return}y()},[t,e]);let y=async()=>{try{o(!0);let e=await (0,i.US)();x(e),h({name:e.name,bio:e.bio||"",profileImage:e.profileImage||""})}catch(r){var t;console.error("Failed to load profile:",r),(null==r?void 0:null===(t=r.response)||void 0===t?void 0:t.status)===401&&e.push("/login")}finally{o(!1)}},j=()=>{let e={};return(!f.name||f.name.trim().length<2)&&(e.name="이름은 최소 2자 이상이어야 합니다"),f.name.trim().length>50&&(e.name="이름은 최대 50자까지 가능합니다"),f.bio&&f.bio.length>500&&(e.bio="자기소개는 최대 500자까지 가능합니다"),b(e),0===Object.keys(e).length},v=async t=>{if(t.preventDefault(),j())try{m(!0),await (0,i.ck)(f),c.A.success("프로필이 성공적으로 수정되었습니다"),e.push("/mypage")}catch(e){console.error("Failed to update profile:",e),c.A.error("프로필 수정에 실패했습니다")}finally{m(!1)}};return r?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})}):p?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"프로필 수정"}),(0,a.jsx)("p",{className:"mt-2 text-gray-600",children:"내 정보를 수정하고 업데이트하세요"})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-8",children:(0,a.jsxs)("form",{onSubmit:v,children:[(0,a.jsx)("div",{className:"mb-8",children:(0,a.jsx)(u,{currentImage:f.profileImage||null,userName:p.name,onImageChange:e=>{h({...f,profileImage:e})}})}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"이메일"}),(0,a.jsx)("input",{type:"email",value:p.email,disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 text-gray-600 cursor-not-allowed"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-500",children:"이메일은 변경할 수 없습니다"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["이름 ",(0,a.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,a.jsx)("input",{type:"text",value:f.name,onChange:e=>h({...f,name:e.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent ".concat(g.name?"border-red-500":"border-gray-300"),placeholder:"이름을 입력하세요 (2-50자)",maxLength:50}),g.name&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-500",children:g.name}),(0,a.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:[f.name.length," / 50자"]})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"자기소개"}),(0,a.jsx)("textarea",{value:f.bio,onChange:e=>h({...f,bio:e.target.value}),rows:5,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none ".concat(g.bio?"border-red-500":"border-gray-300"),placeholder:"자신을 소개하는 글을 작성해보세요 (최대 500자)",maxLength:500}),g.bio&&(0,a.jsx)("p",{className:"mt-1 text-sm text-red-500",children:g.bio}),(0,a.jsxs)("p",{className:"mt-1 text-xs text-gray-500",children:[(f.bio||"").length," / 500자"]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{type:"submit",disabled:l,className:"flex-1 px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:l?"저장 중...":"저장"}),(0,a.jsx)("button",{type:"button",onClick:()=>{window.confirm("수정을 취소하시겠습니까? 변경사항이 저장되지 않습니다.")&&e.push("/mypage")},disabled:l,className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed font-medium",children:"취소"})]})]})})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsx)("p",{className:"text-gray-600",children:"프로필을 불러올 수 없습니다"})})}},6305:function(e,t,r){"use strict";r.d(t,{x:function(){return o}});var a=r(3464),s=r(9375),n=r(7802);let i="http://localhost:4000",o=a.Z.create({baseURL:i,headers:{"Content-Type":"application/json"}});o.interceptors.request.use(e=>{let{accessToken:t}=s.t.getState();return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),o.interceptors.response.use(e=>e,async e=>{var t,r;let l=e.config;if(!e.response)return n.A.error("인터넷 연결을 확인해주세요"),Promise.reject(e);if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!l._retry){l._retry=!0;try{let{refreshToken:e}=s.t.getState();if(!e)throw Error("No refresh token");let{accessToken:t,refreshToken:r}=(await a.Z.post("".concat(i,"/api/auth/refresh"),{refreshToken:e})).data,{user:n}=s.t.getState();return n&&s.t.getState().setAuth(n,t,r),l.headers.Authorization="Bearer ".concat(t),o(l)}catch(e){return s.t.getState().clearAuth(),n.A.error("세션이 만료되었습니다. 다시 로그인해주세요"),window.location.href="/login",Promise.reject(e)}}403===e.response.status&&n.A.error("접근 권한이 없습니다"),404===e.response.status&&n.A.error("요청하신 정보를 찾을 수 없습니다"),e.response.status>=500&&n.A.error("일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요");let c=null===(r=e.response.data)||void 0===r?void 0:r.message;if(c&&![401,403,404].includes(e.response.status)){let e=Array.isArray(c)?c[0]:c;n.A.error(e)}return Promise.reject(e)})},426:function(e,t,r){"use strict";r.d(t,{e:function(){return s}});var a=r(6305);let s=async e=>{let t=new FormData;return e.forEach(e=>{t.append("images",e)}),(await a.x.post("/api/api/upload/images",t,{headers:{"Content-Type":"multipart/form-data"}})).data}},9032:function(e,t,r){"use strict";r.d(t,{C:function(){return o},Cp:function(){return i},US:function(){return s},ck:function(){return n},uN:function(){return l}});var a=r(6305);let s=async()=>(await a.x.get("/api/api/users/me/profile")).data,n=async e=>(await a.x.put("/api/api/users/me/profile",e)).data,i=async e=>(await a.x.put("/api/api/users/me/password",e)).data,o=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await a.x.get("/api/api/users/me/boards",{params:e})).data},l=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(await a.x.get("/api/api/users/me/reviews",{params:e})).data}},9375:function(e,t,r){"use strict";r.d(t,{t:function(){return n}});var a=r(9625),s=r(6885);let n=(0,a.Ue)()((0,s.tJ)(e=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,setAuth:(t,r,a)=>e({user:t,accessToken:r,refreshToken:a,isAuthenticated:!0}),clearAuth:()=>e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1}),updateUser:t=>e(e=>({user:e.user?{...e.user,...t}:null}))}),{name:"auth-storage"}))},7802:function(e,t,r){"use strict";r.d(t,{A:function(){return s},E:function(){return a}});let a=(0,r(9625).Ue)(e=>({toasts:[],addToast:t=>{let r="toast-".concat(Date.now(),"-").concat(Math.random()),a={id:r,duration:3e3,...t};e(e=>({toasts:[...e.toasts,a]})),a.duration&&setTimeout(()=>{e(e=>({toasts:e.toasts.filter(e=>e.id!==r)}))},a.duration)},removeToast:t=>e(e=>({toasts:e.toasts.filter(e=>e.id!==t)})),clearToasts:()=>e({toasts:[]})})),s={success:(e,t)=>a.getState().addToast({type:"success",message:e,duration:t}),error:(e,t)=>a.getState().addToast({type:"error",message:e,duration:t}),warning:(e,t)=>a.getState().addToast({type:"warning",message:e,duration:t}),info:(e,t)=>a.getState().addToast({type:"info",message:e,duration:t})}}},function(e){e.O(0,[3464,5883,3145,2971,2117,1744],function(){return e(e.s=4115)}),_N_E=e.O()}]);