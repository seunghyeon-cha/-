(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6186],{3207:function(e,t,a){Promise.resolve().then(a.bind(a,1038))},9376:function(e,t,a){"use strict";var s=a(5475);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},1038:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var s=a(7437),r=a(2265),n=a(9376),i=a(6305);let l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(await i.x.get("/api/promotions/places/".concat(e),{params:{includeInactive:t}})).data},o=async()=>(await i.x.get("/api/promotions/my")).data,c=async(e,t)=>(await i.x.post("/api/promotions/places/".concat(e),t)).data,d=async(e,t)=>(await i.x.put("/api/promotions/".concat(e),t)).data,u=async e=>(await i.x.delete("/api/promotions/".concat(e))).data,x=async e=>(await i.x.put("/api/promotions/".concat(e,"/toggle"))).data;var m=a(5188),p=a(7802);function h(){(0,n.useRouter)();let e=(0,n.useSearchParams)().get("placeId"),[t,a]=(0,r.useState)([]),[i,h]=(0,r.useState)([]),[g,y]=(0,r.useState)(!0),[f,v]=(0,r.useState)(e||"all"),[b,j]=(0,r.useState)("all"),[w,N]=(0,r.useState)("all"),[A,D]=(0,r.useState)(!1),[k,S]=(0,r.useState)(null),[C,T]=(0,r.useState)({title:"",description:"",startDate:"",endDate:"",isActive:!0}),[P,F]=(0,r.useState)("");(0,r.useEffect)(()=>{E()},[]),(0,r.useEffect)(()=>{e&&e!==f&&v(e)},[e]),(0,r.useEffect)(()=>{"all"!==f?R():_()},[f]);let E=async()=>{try{y(!0);let[e,t]=await Promise.all([o(),(0,m.C3)()]);a(e),h(t)}catch(e){console.error("Failed to load data:",e),p.A.error("데이터를 불러오는데 실패했습니다")}finally{y(!1)}},_=async()=>{try{let e=await o();a(e)}catch(e){console.error("Failed to load promotions:",e),p.A.error("프로모션 목록을 불러오는데 실패했습니다")}},R=async()=>{if("all"!==f)try{let e=await l(f,!0);a(e)}catch(e){console.error("Failed to load place promotions:",e),p.A.error("프로모션 목록을 불러오는데 실패했습니다")}},q=()=>{S(null),T({title:"",description:"",startDate:"",endDate:"",isActive:!0}),F("all"!==f?f:""),D(!0)},L=e=>{S(e),T({title:e.title,description:e.description,startDate:e.startDate.split("T")[0],endDate:e.endDate.split("T")[0],isActive:e.isActive}),F(e.placeId),D(!0)},U=async e=>{if(e.preventDefault(),!P){p.A.error("업장을 선택해주세요");return}if(new Date(C.endDate)<=new Date(C.startDate)){p.A.error("종료일은 시작일보다 이후여야 합니다");return}try{k?(await d(k.id,C),p.A.success("프로모션이 수정되었습니다")):(await c(P,C),p.A.success("프로모션이 생성되었습니다")),D(!1),"all"!==f?R():_()}catch(e){var t,a;console.error("Failed to save promotion:",e),p.A.error((null===(a=e.response)||void 0===a?void 0:null===(t=a.data)||void 0===t?void 0:t.message)||"프로모션 저장에 실패했습니다")}},z=async(e,t)=>{if(confirm('"'.concat(t,'" 프로모션을 삭제하시겠습니까?')))try{await u(e),p.A.success("프로모션이 삭제되었습니다"),"all"!==f?R():_()}catch(e){console.error("Failed to delete promotion:",e),p.A.error("프로모션 삭제에 실패했습니다")}},I=async e=>{try{await x(e),"all"!==f?R():_()}catch(e){console.error("Failed to toggle promotion:",e),p.A.error("프로모션 상태 변경에 실패했습니다")}},B=(e,t,a)=>{let s=new Date,r=new Date(e);return new Date(t)<s?{label:"종료",color:"bg-gray-100 text-gray-800",emoji:"⚫"}:r>s?{label:"예정",color:"bg-yellow-100 text-yellow-800",emoji:"\uD83D\uDFE1"}:a?{label:"진행중",color:"bg-green-100 text-green-800",emoji:"\uD83D\uDFE2"}:{label:"일시중지",color:"bg-red-100 text-red-800",emoji:"\uD83D\uDD34"}},K=t.filter(e=>{let t=B(e.startDate,e.endDate,e.isActive);return("active"!==b||"진행중"===t.label)&&("scheduled"!==b||"예정"===t.label)&&("ended"!==b||"종료"===t.label)&&("active"!==w||!!e.isActive)&&("inactive"!==w||!e.isActive)});return g?(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6 animate-pulse",children:[(0,s.jsx)("div",{className:"h-8 bg-gray-200 rounded w-48 mb-4"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-64"})]})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"프로모션 관리"}),(0,s.jsxs)("p",{className:"mt-1 text-sm text-gray-600",children:["총 ",K.length,"개의 프로모션"]})]}),(0,s.jsx)("button",{onClick:q,className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"+ 프로모션 생성"})]}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-3",children:[(0,s.jsxs)("select",{value:f,onChange:e=>v(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[(0,s.jsx)("option",{value:"all",children:"전체 업장"}),i.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,s.jsxs)("select",{value:b,onChange:e=>j(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[(0,s.jsx)("option",{value:"all",children:"전체 상태"}),(0,s.jsx)("option",{value:"active",children:"진행중"}),(0,s.jsx)("option",{value:"scheduled",children:"예정"}),(0,s.jsx)("option",{value:"ended",children:"종료"})]}),(0,s.jsxs)("select",{value:w,onChange:e=>N(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[(0,s.jsx)("option",{value:"all",children:"전체"}),(0,s.jsx)("option",{value:"active",children:"활성"}),(0,s.jsx)("option",{value:"inactive",children:"비활성"})]})]})]}),0===K.length?(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-sm p-12 text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83C\uDFAF"}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"프로모션이 없습니다"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:"새로운 프로모션을 생성하여 고객에게 특별한 혜택을 제공하세요"}),(0,s.jsx)("button",{onClick:q,className:"px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"프로모션 생성"})]}):(0,s.jsx)("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-50 border-b border-gray-200",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"제목"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"업장"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"기간"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"상태"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"활성"}),(0,s.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"액션"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:K.map(e=>{var t;let a=B(e.startDate,e.endDate,e.isActive),r=(null===(t=i.find(t=>t.id===e.placeId))||void 0===t?void 0:t.name)||"-";return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsxs)("td",{className:"px-6 py-4",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,s.jsx)("div",{className:"text-sm text-gray-500 line-clamp-1",children:e.description})]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("div",{className:"text-sm text-gray-900",children:r})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("div",{className:"text-sm text-gray-900",children:[new Date(e.startDate).toLocaleDateString("ko-KR",{month:"short",day:"numeric"})," ~ ",new Date(e.endDate).toLocaleDateString("ko-KR",{month:"short",day:"numeric"})]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsxs)("span",{className:"inline-flex items-center gap-1 px-2.5 py-0.5 rounded-full text-xs font-medium ".concat(a.color),children:[a.emoji," ",a.label]})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,s.jsx)("button",{onClick:()=>I(e.id),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2 ".concat(e.isActive?"bg-primary-600":"bg-gray-200"),children:(0,s.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(e.isActive?"translate-x-6":"translate-x-1")})})}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,s.jsx)("button",{onClick:()=>L(e),className:"text-primary-600 hover:text-primary-900 mr-4",children:"수정"}),(0,s.jsx)("button",{onClick:()=>z(e.id,e.title),className:"text-red-600 hover:text-red-900",children:"삭제"})]})]},e.id)})})]})})}),A&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,s.jsx)("div",{className:"bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:k?"프로모션 수정":"프로모션 생성"}),(0,s.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[!k&&(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["업장 선택 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsxs)("select",{value:P,onChange:e=>F(e.target.value),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500",children:[(0,s.jsx)("option",{value:"",children:"업장을 선택하세요"}),i.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["제목 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:C.title,onChange:e=>T({...C,title:e.target.value}),required:!0,maxLength:100,placeholder:"예: 봄맞이 특별 할인",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["설명 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("textarea",{value:C.description,onChange:e=>T({...C,description:e.target.value}),required:!0,rows:4,placeholder:"프로모션 내용을 자세히 입력하세요",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["시작일 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"date",value:C.startDate,onChange:e=>T({...C,startDate:e.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["종료일 ",(0,s.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,s.jsx)("input",{type:"date",value:C.endDate,onChange:e=>T({...C,endDate:e.target.value}),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("input",{type:"checkbox",id:"isActive",checked:C.isActive,onChange:e=>T({...C,isActive:e.target.checked}),className:"w-5 h-5 text-primary-600 border-gray-300 rounded focus:ring-primary-500"}),(0,s.jsx)("label",{htmlFor:"isActive",className:"text-sm font-medium text-gray-700",children:"즉시 활성화"})]}),(0,s.jsxs)("div",{className:"flex gap-3 justify-end pt-4",children:[(0,s.jsx)("button",{type:"button",onClick:()=>D(!1),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",children:"취소"}),(0,s.jsx)("button",{type:"submit",className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:k?"수정":"생성"})]})]})]})})})]})}},5188:function(e,t,a){"use strict";a.d(t,{$e:function(){return r},Ai:function(){return n},C3:function(){return i},Qx:function(){return o},V_:function(){return l},j_:function(){return c}});var s=a(6305);let r=async e=>(await s.x.post("/api/business/verify",e)).data,n=async()=>(await s.x.get("/api/business/verify/status")).data,i=async()=>(await s.x.get("/api/business/places")).data,l=async()=>(await s.x.get("/api/business/stats")).data,o=async()=>(await s.x.get("/api/business/stats/places")).data,c=async e=>(await s.x.get("/api/business/stats/places/".concat(e))).data},6305:function(e,t,a){"use strict";a.d(t,{x:function(){return l}});var s=a(3464),r=a(9375),n=a(7802);let i="http://localhost:4000",l=s.Z.create({baseURL:i,headers:{"Content-Type":"application/json"}});l.interceptors.request.use(e=>{let{accessToken:t}=r.t.getState();return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),l.interceptors.response.use(e=>e,async e=>{var t,a;let o=e.config;if(!e.response)return n.A.error("인터넷 연결을 확인해주세요"),Promise.reject(e);if((null===(t=e.response)||void 0===t?void 0:t.status)===401&&!o._retry){o._retry=!0;try{let{refreshToken:e}=r.t.getState();if(!e)throw Error("No refresh token");let{accessToken:t,refreshToken:a}=(await s.Z.post("".concat(i,"/api/auth/refresh"),{refreshToken:e})).data,{user:n}=r.t.getState();return n&&r.t.getState().setAuth(n,t,a),o.headers.Authorization="Bearer ".concat(t),l(o)}catch(e){return r.t.getState().clearAuth(),n.A.error("세션이 만료되었습니다. 다시 로그인해주세요"),window.location.href="/login",Promise.reject(e)}}403===e.response.status&&n.A.error("접근 권한이 없습니다"),404===e.response.status&&n.A.error("요청하신 정보를 찾을 수 없습니다"),e.response.status>=500&&n.A.error("일시적인 오류가 발생했습니다. 잠시 후 다시 시도해주세요");let c=null===(a=e.response.data)||void 0===a?void 0:a.message;if(c&&![401,403,404].includes(e.response.status)){let e=Array.isArray(c)?c[0]:c;n.A.error(e)}return Promise.reject(e)})},9375:function(e,t,a){"use strict";a.d(t,{t:function(){return n}});var s=a(9625),r=a(6885);let n=(0,s.Ue)()((0,r.tJ)(e=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,setAuth:(t,a,s)=>e({user:t,accessToken:a,refreshToken:s,isAuthenticated:!0}),clearAuth:()=>e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1}),updateUser:t=>e(e=>({user:e.user?{...e.user,...t}:null}))}),{name:"auth-storage"}))},7802:function(e,t,a){"use strict";a.d(t,{A:function(){return r},E:function(){return s}});let s=(0,a(9625).Ue)(e=>({toasts:[],addToast:t=>{let a="toast-".concat(Date.now(),"-").concat(Math.random()),s={id:a,duration:3e3,...t};e(e=>({toasts:[...e.toasts,s]})),s.duration&&setTimeout(()=>{e(e=>({toasts:e.toasts.filter(e=>e.id!==a)}))},s.duration)},removeToast:t=>e(e=>({toasts:e.toasts.filter(e=>e.id!==t)})),clearToasts:()=>e({toasts:[]})})),r={success:(e,t)=>s.getState().addToast({type:"success",message:e,duration:t}),error:(e,t)=>s.getState().addToast({type:"error",message:e,duration:t}),warning:(e,t)=>s.getState().addToast({type:"warning",message:e,duration:t}),info:(e,t)=>s.getState().addToast({type:"info",message:e,duration:t})}}},function(e){e.O(0,[3464,5883,2971,2117,1744],function(){return e(e.s=3207)}),_N_E=e.O()}]);